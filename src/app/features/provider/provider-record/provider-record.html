<div class="container-fluid">
  <h2 class="mb-4">Manage Patient Records</h2>
  <div class="card mb-4">
    <div class="card-header">Add New Record</div>
    <div class="card-body">
      <form [formGroup]="recordForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label for="patientAddress" class="form-label">Patient Address</label>
          <input type="text" class="form-control" id="patientAddress" formControlName="patientAddress" placeholder="0x...">
          <div *ngIf="recordForm.get('patientAddress')?.invalid && recordForm.get('patientAddress')?.touched" class="text-danger">
            Enter a valid Ethereum address.
          </div>
        </div>
        <div class="mb-3">
          <label for="title" class="form-label">Record Title</label>
          <input type="text" class="form-control" id="title" formControlName="title" placeholder="e.g., Consultation Notes">
          <div *ngIf="recordForm.get('title')?.invalid && recordForm.get('title')?.touched" class="text-danger">
            Title is required and must be at least 3 characters.
          </div>
        </div>
        <div class="mb-3">
          <label for="data" class="form-label">Record Data</label>
          <textarea class="form-control" id="data" formControlName="data" placeholder="Enter record details (JSON format)" rows="5"></textarea>
          <div *ngIf="recordForm.get('data')?.invalid && recordForm.get('data')?.touched" class="text-danger">
            Data is required and must be at least 10 characters.
          </div>
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || recordForm.invalid">
          {{ isSubmitting ? 'Adding...' : 'Add Record' }}
        </button>
        <button type="button" class="btn btn-secondary ms-2" (click)="loadRecords()" [disabled]="isSubmitting || recordForm.get('patientAddress')?.invalid">
          Load Records
        </button>
      </form>
    </div>
  </div>
  <div class="card">
    <div class="card-header">Patient Records</div>
    <div class="card-body">
      <div class="accordion" id="recordsAccordion">
        <div *ngFor="let record of records; let i = index" class="accordion-item">
          <h2 class="accordion-header" [id]="'heading' + i">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + i" aria-expanded="true" [attr.aria-controls]="'collapse' + i">
              {{ record.title }} ({{ record.createdAt | date:'short' }})
            </button>
          </h2>
          <div [id]="'collapse' + i" class="accordion-collapse collapse" [attr.aria-labelledby]="'heading' + i" data-bs-parent="#recordsAccordion">
            <div class="accordion-body">
              <pre>{{ record.data | json }}</pre>
            </div>
          </div>
        </div>
        <div *ngIf="!records.length" class="text-center">No records found</div>
      </div>
    </div>
  </div>
</div>